{% extends 'main.html' %}

{% block content %}
    <style>
        /* Your CSS styles */
    </style>

    <div class="chat-container">
        <textarea id="chat-log" readonly></textarea>
        <div class="input-group">
            <input id="chat-message-input" type="text" placeholder="Type your message..." autocomplete="off" />
            <button id="send-message">Send</button>
        </div>
    </div>
{% endblock %}


<script>
    const roomName = 'user1-user2'; 
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const chatSocket = new WebSocket(protocol + window.location.host + '/ws/chatroom/' + roomName + '/');

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const message = data['message'];
        const sender = data['sender'];

        // Display message in chat log
        const chatLog = document.querySelector('#chat-log');
        chatLog.value += `${sender}: ${message}\n`;
        chatLog.scrollTop = chatLog.scrollHeight;  // Auto-scroll
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#send-message').onclick = function() {
        const messageInputDom = document.querySelector('#chat-message-input');
        const message = messageInputDom.value;

        if (message.trim() !== '') {
            chatSocket.send(JSON.stringify({'message': message}));
            messageInputDom.value = '';  // Clear input
        }
    };
</script>